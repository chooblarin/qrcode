package main

import (
	"bytes"
	"fmt"
	"go/format"
	"log"
	"os"
)

// x^8 = x^4 + x^3 + x^2 + 1
const g = 1<<8 + 1<<4 + 1<<3 + 1<<2 + 1

func main() {
	var buf bytes.Buffer

	var expTable [256]byte
	var logTable [256]int

	fmt.Fprintln(&buf, "// Code generated by gen/main.go; DO NOT EDIT.")
	fmt.Fprintln(&buf)
	fmt.Fprintln(&buf, "package reedsolomon")
	fmt.Fprintln(&buf, "var expTable = [256]element{")
	var v uint = 1
	for i := 0; i < 16; i++ {
		for j := 0; j < 16; j++ {
			fmt.Fprintf(&buf, "0x%02x,", v)
			if i*16+j < 255 {
				logTable[v] = i*16 + j
				expTable[i*16+j] = byte(v)
			}
			v <<= 1
			v ^= (v >> 8) * g
		}
		fmt.Fprintln(&buf)
	}
	fmt.Fprintln(&buf, "}")
	fmt.Fprintln(&buf)
	fmt.Fprintln(&buf, "var logTable = [256]int{")
	for i := 0; i < 16; i++ {
		for j := 0; j < 16; j++ {
			fmt.Fprintf(&buf, "0x%02x,", logTable[i*16+j])
		}
		fmt.Fprintln(&buf)
	}
	fmt.Fprintln(&buf, "}")

	out, err := format.Source(buf.Bytes())
	if err != nil {
		log.Fatal(err)
	}
	if err := os.WriteFile("generated.go", out, 0o644); err != nil {
		log.Fatal(err)
	}
}
